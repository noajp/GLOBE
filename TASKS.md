# 🌍 GLOBE App タスク管理

**最終更新**: 2025-10-23
**開発状況**: Version 1.0 - 95%完了

このドキュメントは、AGENTS.md、REFACTORING_PLAN.md、README.md、CLAUDE.mdから統合されたタスク管理ファイルです。

---

## 📊 Version 1.0 リリース前 必須タスク

### 🔴 Critical - 実装必須（リリースブロッカー）

#### 1. コード修正
- [ ] **SupabaseService.fetchUserPosts() の実装**
  - 📍 場所: `GLOBE/Repositories/SupabaseService.swift:33-35`
  - 🐛 問題: 現在は空配列を返すモック実装
  - ✅ 実装: Supabaseからユーザーの投稿を取得
  ```swift
  func fetchUserPosts(userId: String) async -> [Post] {
      // TODO: Implement actual Supabase query
      // SELECT * FROM posts WHERE user_id = userId
      return []  // ← 修正が必要
  }
  ```
  - 📝 影響: プロフィール画面で投稿が表示されない

#### 2. コードクリーンアップ
- [ ] **開発用ログ・コメントの削除**
  - `print()` デバッグ文の削除
  - `// TODO` コメントの確認と対応
  - `// FIXME` の修正
  - テスト用ダミーデータの削除

- [ ] **未使用コードの削除**
  - 未使用のimport文
  - コメントアウトされたコード
  - デッドコード（呼び出されていない関数）

#### 3. App Store 準備
- [ ] **Appアイコンの作成**
  - 1024x1024px (App Store用)
  - その他必要なサイズ自動生成
  - デザイン: 地球儀/地図モチーフ

- [ ] **スクリーンショット準備**
  - 6.7" (iPhone 16 Pro Max)
  - 6.5" (iPhone 15 Plus)
  - 5.5" (iPhone 8 Plus)
  - 各サイズ最低5枚

- [ ] **プライバシーポリシーの作成と公開**
  - 収集する情報: 位置情報、メールアドレス、投稿内容
  - データ保持期間: 投稿は永続化（24時間制限を削除）
  - 第三者共有: Supabaseのみ
  - ホスティング: GitHub Pages または 独自ドメイン

- [ ] **利用規約の作成と公開**
  - 禁止事項の明記
  - 免責事項
  - アカウント削除ポリシー

#### 4. 本番環境設定
- [ ] **Production Supabase環境の確認**
  - 本番用URL/Keyの確認
  - RLSポリシーの最終確認
  - データベースインデックスの最適化
  - ストレージバケットの権限確認

#### 5. テスト
- [ ] **実機での総合テスト**
  - 認証フロー（サインアップ→ログイン→ログアウト）
  - 投稿作成（テキスト、画像、位置情報）
  - マップ表示とズーム動作
  - プロフィール表示と編集
  - いいね機能
  - 画像アップロード

- [ ] **App Store Connect 登録**
  - アプリ情報入力
  - スクリーンショットアップロード
  - プライバシーポリシーURL設定
  - 価格設定（無料）

- [ ] **TestFlight ベータテスト**
  - 内部テスター5名以上
  - 最低1週間のテスト期間
  - クリティカルバグの修正

---

## 🟡 Version 1.0 リリース時点の実装状況

### ✅ 実装済み（95%）

#### Core機能
- ✅ **認証システム** (AuthManager.swift)
  - サインアップ/ログイン/ログアウト
  - セッション管理と自動更新
  - パスワード強度検証
  - レート制限とセキュリティチェック
  - デバイスセキュリティ検証（Jailbreak検出）

- ✅ **投稿管理** (PostManager.swift, SupabaseService.swift)
  - 投稿作成（テキスト、画像、位置情報）
  - 投稿取得（全体、位置範囲指定）
  - 投稿削除
  - いいね機能
  - 匿名投稿対応
  - 画像アップロード（Supabase Storage）

- ✅ **マップ機能** (MapManager.swift)
  - MapKit統合
  - 現在地表示（青い円）
  - ズームレベルに応じた投稿フィルタリング
  - 投稿ピンの表示
  - 位置情報プライバシー（エリア名のみ表示）

- ✅ **プロフィール管理** (MyPageViewModel.swift)
  - プロフィール表示
  - プロフィール編集
  - アバター画像アップロード
  - 投稿一覧表示（fetchUserPosts修正後）

#### セキュリティ
- ✅ **InputValidator.swift**
  - コンテンツ検証とサニタイゼーション
  - スパム/有害コンテンツ検出
  - 個人情報漏洩防止
  - 位置情報安全性検証

- ✅ **SecureLogger.swift**
  - 機密情報の自動マスキング
  - セキュリティイベントログ
  - 重要度レベル別ロギング
  - 監査証跡

- ✅ **DatabaseSecurity.swift**
  - SQLインジェクション防止
  - クエリレート制限
  - Row Level Security検証
  - データベース操作監査ログ

#### UI/UX
- ✅ **Liquid Glass Design System**
  - ガラスモーフィズム効果
  - ダークテーマ
  - カスタムタブバー（LiquidGlassBottomTabBar）
  - アニメーション

- ✅ **投稿UI**
  - PostPin（吹き出しデザイン）
  - PostPopupView（投稿作成）
  - ScalablePostPin（ズーム対応）
  - ProfilePopupView

- ✅ **テスト**
  - ユニットテスト（InputValidator, AuthManager, PostManager）
  - 統合テスト（認証フロー）
  - UIテスト（CriticalFlowUITests, GLOBEUITests）
  - ViewModelテスト（MyPageViewModel）

### 🔴 未実装（5%）

- 🔴 **SupabaseService.fetchUserPosts()** - モック実装のみ（上記 Critical タスクで対応）

---

## 🟢 Version 1.1+ 今後の実装（リリース後）

### 優先度: 低 - リリース後に実装

#### 1. リアルタイム機能
- [ ] **Supabase Realtime 統合**
  - 新規投稿のリアルタイム更新
  - いいねのリアルタイム同期
  - オンラインユーザー表示

#### 2. プッシュ通知
- [ ] **APNs統合**
  - 新しい投稿通知
  - いいね通知
  - フォロワー通知
  - メンション通知

#### 3. ソーシャル機能拡張
- [ ] **コメント機能**
  - 投稿へのコメント
  - コメント通知
  - コメント削除

- [ ] **フォロー機能**
  - ユーザーフォロー/アンフォロー
  - フォロワー一覧
  - フォロー中一覧

- [ ] **DM（ダイレクトメッセージ）**
  - 1対1チャット
  - エンドツーエンド暗号化
  - 画像送信

#### 4. 検索・発見機能
- [ ] **投稿検索**
  - キーワード検索
  - ハッシュタグ検索
  - 位置検索

- [ ] **ユーザー検索**
  - ユーザー名検索
  - 位置ベースユーザー発見

#### 5. 分析・統計
- [ ] **Analytics統合**
  - Firebase Analytics
  - ユーザー行動分析
  - クラッシュレポート

---

## 🏗️ 大規模リファクタリング（Version 2.0）

**推定期間**: 8週間
**優先度**: 低（リリース後、ユーザーフィードバック反映後）

これらのタスクは REFACTORING_PLAN.md から抽出されています。

### Phase 1: アーキテクチャ基盤（1-2週間）
- [ ] 標準化された依存性注入実装
- [ ] サービスインターフェース統合
- [ ] AppStateの焦点化されたモジュールへの分割
- [ ] リポジトリファクトリーパターン作成

### Phase 2: サービス層リファクタリング（3-4週間）
- [ ] SupabaseServiceとリポジトリパターンのマージ
- [ ] 強化されたキャッシュ戦略実装
- [ ] Manager責任の統合
- [ ] サービス間でのエラーハンドリング標準化

### Phase 3: UIコンポーネントリファクタリング（5-6週間）
- [ ] 大規模コンポーネントの分解
  - PostPopupView → PostComposer + PostEditor + PostPreview + PostPublisher
- [ ] コンポーネントライブラリ構造実装
  - Foundation/, LiquidGlass/, Forms/, Media/, Navigation/
- [ ] コンポーネント合成パターン追加
- [ ] Liquid Glassデザインシステム強化

### Phase 4: パフォーマンス & テスト強化（7-8週間）
- [ ] パフォーマンス最適化実装
  - ViewBuilder最適化
  - メモリ管理強化
  - ネットワーク層最適化
- [ ] 包括的モック層追加
- [ ] テストカバレッジ90%以上に向上
- [ ] パフォーマンス監視追加

---

## 📋 チェックリスト（Version 1.0リリース前）

### 必須項目
- [ ] fetchUserPosts() 実装完了
- [ ] 開発用ログ削除完了
- [ ] Appアイコン作成完了
- [ ] スクリーンショット準備完了
- [ ] プライバシーポリシー公開完了
- [ ] 利用規約公開完了
- [ ] 実機テスト完了（クリティカルバグゼロ）
- [ ] App Store Connect 登録完了
- [ ] TestFlightベータテスト完了

### 推奨項目
- [ ] コードレビュー実施
- [ ] セキュリティ監査実施
- [ ] パフォーマンステスト実施
- [ ] アクセシビリティチェック
- [ ] 多言語対応検討（日本語→英語）

---

## 🎯 成功指標（Version 1.0）

### リリース基準
- ✅ クリティカルバグ: 0件
- ✅ テストカバレッジ: 80%以上
- ✅ アプリサイズ: 50MB以下
- ✅ 起動時間: 3秒以内
- ✅ クラッシュ率: 1%以下

### KPI（リリース後1ヶ月）
- 📈 DAU（デイリーアクティブユーザー）: 100+
- 📈 投稿数: 500+
- 📈 ユーザー定着率: 30%以上
- ⭐ App Store評価: 4.0以上

---

## 📝 Notes

### 変更履歴
- **2025-10-23**: AGENTS.md、REFACTORING_PLAN.md、README.md、CLAUDE.mdから統合
- Version 1.0を95%完了と評価
- リリース必須タスクと今後の実装を明確に分離

### 参照ドキュメント
- [CLAUDE.md](./CLAUDE.md) - Claude AI向け詳細仕様（開発状況: 85%完了）
- [AGENTS.md](./AGENTS.md) - AI開発者向けガイドライン（開発状況: 45%完了）
- [REFACTORING_PLAN.md](./REFACTORING_PLAN.md) - 大規模リファクタリング計画（Version 2.0）
- [README.md](./README.md) - プロジェクト概要とアーキテクチャ

### 重要な決定事項
1. **投稿の永続化**: 当初24時間で自動削除の予定だったが、Version 1.0では永続化に変更（SupabaseService.swift:265）
2. **匿名投稿**: 実装済み、投稿内容は公開だがユーザー情報は匿名化
3. **セキュリティ**: 全テーブルRLS有効、包括的セキュリティコンポーネント実装済み
